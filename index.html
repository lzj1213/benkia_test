<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>奔凯智慧社区</title>
  <link rel="stylesheet" href="./css/index.css">
  <link rel="stylesheet" href="./css/iconfont.css">
</head>

<body>
  <div class="top_bar">
    <div class="count">
      <div class='population'>人口总数
        <b>1567700</b>
        <span>人</span>
      </div>
      <div class='houses'>房屋总数
        <b>325</b>
        <span>栋</span>
      </div>
    </div>
    <div class='center_wrapper'>
      <h1>智慧社区大数据云平台系统</h1>
      <p>
        <span id='date'></span>
        <span id='week'></span>
        <span id='nowTime'></span>
      </p>
      <div class="search">
        <input type="text" placeholder="请输入地址">
        <span class='iconfont icon-search'></span>
        <span class='iconfont icon-calendar'></span>
        <div id="calendar"></div>
      </div>
    </div>
  </div>
  <div class="left_side">
    <div class='box-wrapper card_type'>
      <span class="iconfont icon-triangle_down"></span>
      <div class="topTittle">开门类型
      </div>
      <div class="defaultBox show">
        <div>
          <div class="percent">
            <input type="text" value='24.05'>
            <span>%</span>
          </div>
          <div class='inner_box'>
            <p class="type_name">CPU门卡</p>
          </div>
        </div>
        <div>
          <div class="percent">
            <input type="text" value='22.53'>
            <span>%</span>
          </div>
          <div class='inner_box'>
            <p class="type_name">IC卡</p>
          </div>
        </div>
        <div>
          <div class="percent">
            <input type="text" value='18.91'>
            <span>%</span>
          </div>
          <div class='inner_box'>
            <p class="type_name">APP</p>
          </div>
        </div>
        <div>
          <div class="percent">
            <input type="text" value='12.82'>
            <span>%</span>
          </div>
          <div class='inner_box'>
            <p class="type_name">呼叫对讲</p>
          </div>
        </div>
        <div>
          <div class="percent">
            <input type="text" value='11.18'>
            <span>%</span>
          </div>
          <div class='inner_box'>
            <p class="type_name">动态密码</p>
          </div>
        </div>
        <div>
          <div class="percent">
            <input type="text" value='10.51'>
            <span>%</span>
          </div>
          <div class='inner_box'>
            <p class="type_name">身份/居住证</p>
          </div>
        </div>
      </div>
    </div>
    <div class='box-wrapper educational_level'>
      <span class="iconfont icon-triangle_down "></span>
      <div class="topTittle">文化水平
      </div>
      <div id="educational_level" class="defaultBox show">
      </div>
    </div>
    <div class='box-wrapper population'>
      <span class="iconfont icon-triangle_down "></span>
      <div class="topTittle">年龄层次
      </div>
      <div id="population" class="defaultBox show">
      </div>
    </div>
    <div class='box-wrapper monitor'>
      <span class="iconfont icon-triangle_down"></span>
      <div class="topTittle">监控视频
      </div>
      <div class="defaultBox show">
        <div class="video">
          <div class="video_info"></div>
          <img src="./img/1.png" alt="">
        </div>
        <div class="video">
          <div class="video_info"></div>
          <img src="./img/2.png" alt="">
        </div>
        <div class="video">
          <div class="video_info"></div>
          <img src="./img/3.png" alt="">
        </div>
        <div class="video">
          <div class="video_info"></div>
          <img src="./img/4.png" alt="">
        </div>
        <div class="video">
          <div class="video_info"></div>
          <img src="./img/5.png" alt="">
        </div>
        <div class="video">
          <div class="video_info"></div>
          <img src="./img/6.png" alt="">
        </div>
        <div class="video">
          <div class="video_info"></div>
          <img src="./img/7.png" alt="">
        </div>
        <div class="video">
          <div class="video_info"></div>
          <img src="./img/8.png" alt="">
        </div>
        <div class="video">
          <div class="video_info"></div>
          <img src="./img/9.png" alt="">
        </div>

      </div>
    </div>
  </div>
  <div class="right_side">
    <div class='box-wrapper check_status'>
      <span class="iconfont icon-triangle_down "></span>
      <div class="topTittle">入住率
      </div>
      <div id="check_status" class="defaultBox show">
      </div>
    </div>
    <div class='box-wrapper enter_period'>
      <span class="iconfont icon-triangle_down "></span>
      <div class="topTittle">进入时间段
      </div>
      <div id="enter_period" class="defaultBox show">
      </div>
    </div>
    <div class='box-wrapper house_type'>
      <span class="iconfont icon-triangle_down "></span>
      <div class="topTittle">户型占比
      </div>
      <div id="house_type" class="defaultBox show">
      </div>
    </div>
    <div class='box-wrapper special_grounp'>
      <span class="iconfont icon-triangle_down "></span>
      <div class="topTittle tabTittle vulnerable_group active" target-index=0>关爱人群
      </div>
      <div class="tabTittle focus_grounp" target-index=1>重点人群</div>
      <div class="defaultBox show">
        <table cellspacing="0" cellpadding="0" index='0'>
          <thead>
            <tr>
              <td class='name'>姓名</td>
              <td class='tel'>手机号码</td>
              <td class='type'>人员类型</td>
              <td class='residence'>居住地</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>谢小龙</td>
              <td>13539428488</td>
              <td>残疾家庭</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
            <tr>
              <td>谢小龙</td>
              <td>13539428488</td>
              <td>残疾家庭</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
            <tr>
              <td>谢小龙</td>
              <td>13539428488</td>
              <td>残疾家庭</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
            <tr>
              <td>张国</td>
              <td>13539428488</td>
              <td>独居老人</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
            <tr>
              <td>韩玉梅</td>
              <td>13539428488</td>
              <td>低保家庭</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
            <tr>
              <td>农小敏</td>
              <td>13539428488</td>
              <td>困难家庭</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
            <tr>
              <td>宁丹卿</td>
              <td>13539428488</td>
              <td>特殊记载</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
          </tbody>
        </table>
        <table cellspacing="0" cellpadding="0" style='display: none' index='1'>
          <thead>
            <tr>
              <td class='name'>姓名</td>
              <td class='tel'>手机号码</td>
              <td class='type'>人员类型</td>
              <td class='residence'>居住地</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>谢小龙</td>
              <td>13539428488</td>
              <td>有危害国家安全活动嫌疑的</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
            <tr>
              <td>张国</td>
              <td>13539428488</td>
              <td>独居老人</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
            <tr>
              <td>韩玉梅</td>
              <td>13539428488</td>
              <td>低保家庭</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
            <tr>
              <td>农小敏</td>
              <td>13539428488</td>
              <td>困难家庭</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
            <tr>
              <td>宁丹卿</td>
              <td>13539428488</td>
              <td>特殊记载</td>
              <td>龙岗区坂田街道南坑社区北路25号601</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
  <div class="pie_wrapper">
    <div id="checkin_status"></div>
    <div class="resident native"></div>
    <div class="resident non-native "></div>
    <div class="sex male"></div>
    <div class="sex female"></div>
  </div>
  <div class="fixed_wrapper">
    <ul>
      <li>
        <i class='iconfont icon-pick' style='color:#40b385'></i>
        <span>关爱人群</span>
      </li>
      <li>
        <i class='iconfont icon-pick' style='color:#e3531f'></i>
        <span>重点人群</span>
      </li>
      <li>
        <i class='iconfont icon-pick' style='color:#008fff'></i>
        <span>普通人群</span>
      </li>
      <li>
        <i class='iconfont icon-position' style='color:#1ac60d'></i>
        <span>门禁位置</span>
      </li>
      <li>
        <i class='iconfont icon-position' style='color:#ff0000'></i>
        <span> 异常门禁</span>
      </li>
    </ul>
  </div>
</body>
<script src="./js/echarts.js"></script>
<script src='./js/jquery.js'></script>
<script src="./js/layDate-v5.0.9/laydate/laydate.js"></script>
<script>
  $(function () {
    //伸缩自适应
    window.onresize = function () {
      pie1.resize();
      pie2.resize();
      pie3.resize();
      pie4.resize();
      pie5.resize();
    }
    // 时间戳格式化
    function timeFormatter() {
      var time = new Date()
      var y = time.getFullYear();
      var month = time.getMonth().toFixed(0) + 1 > 10 ? time.getMonth() + 1 : '0' + time.getMonth() + 1;
      var d = time.getDate().toFixed(0) + 1 > 10 ? time.getDate() : '0' + time.getDate();
      var h = time.getHours();
      h = h < 10 ? ('0' + h) : h;
      var m = time.getMinutes();
      var s = time.getSeconds();
      m = m < 10 ? ('0' + m) : m;
      s = s < 10 ? ('0' + s) : s;
      var w;
      switch (time.getDay()) {
        case 1:
          w = '周一';
          break;
        case 2:
          w = '周二';
          break;
        case 3:
          w = '周三';
          break;
        case 4:
          w = '周四';
          break;
        case 5:
          w = '周五';
          break;
        case 6:
          w = '周六';
          break;
        case 7:
          w = '周日';
          break;
      }
      return {
        date: y + '/' + month + '/' + d,
        nowTime: h + ':' + m + ':' + s,
        w: w
      }
    }

    function getTimeValue() {
      $('#date').html(timeFormatter().date)
      $('#week').html(timeFormatter().w)
      $('#nowTime').html(timeFormatter().nowTime)
    }
    getTimeValue();
    setInterval(function () {
      getTimeValue();
    }, 1000)
    //根据百分比设置宽度
    function getBoxWidth(ele) {
      var w;
      $(ele).each(function (index, element) {
        w = $(element).siblings('.percent').find('input').val() / 100 * $(element).parent().width();
        $(element).width(w)
      })
    }
    getBoxWidth($('.inner_box'));
    // 点击箭头收起盒子

    $('.box-wrapper .icon-triangle_down').on('click', function () {
      var targetEle = $(this).parent('.box-wrapper').find('.defaultBox');
      $(this).toggleClass('icon-triangle_down');
      $(this).siblings('.topTittle').toggleClass('hide')
      targetEle.toggleClass('hide');
      if ($(this).parents().is('.left_side')) {
        $(this).toggleClass('icon-triangle_right')
      } else {
        $(this).toggleClass('icon-triangle_left');
      }
    })
    $('.topTittle.vulnerable_group.show').html('关爱人群')
    $('.special_grounp .icon-triangle_down').on('click', function () {
      $(this).siblings('.focus_grounp').toggleClass('hide');
      if ($(this).siblings('.topTittle').hasClass('hide')) {
        $(this).siblings('.vulnerable_group').html('特殊人群');
      } else {
        $(this).siblings('.vulnerable_group').html('关爱人群');
      }

    })

    //切换active
    $('.special_grounp .tabTittle').on('click', function () {
      $(this).addClass('active').siblings().removeClass('active');
      var index = $(this).attr('target-index');
      console.log(index);
      $(this).parent().find(`table[index=${index}]`).show().siblings('table').hide()
    })
    //表格鼠标悬停显示标题
    $('.special_grounp tbody tr').on('mousemove', function (e) {
      var e = e || window.event;
      var target = e.target;
      $(target).attr("title", target.innerText);
    })
    console.log(echarts);
    $('.percent input').on('change', function () {
      var w = $(this).val() / 100 * $(this).parent().parent().width();
      console.log(w);
      $(this).parent().siblings('.inner_box').width(w)

    })
    var benkaiData = {
      "CARD_TYPE": {
        "1": "身份证/居住证",
        "2": "ic卡",
        "3": "cpu卡",
        "4": "手机app",
        "5": "动态密码",
        "6": "呼叫对讲"
      },
      "CHECKIN_STATUS": {
        "1": "入住",
        "2": "搬离"
      },
      "EDUCATIONAL_LEVEL": {
        "1": "小学",
        "2": "初中",
        "3": "高中",
        "4": "大专",
        "5": "本科",
        "6": "研究生",
        "7": "硕士",
        "8": "博士"
      },
      "SEX": {
        "0": "女",
        "1": "男"
      },
      "RESIDENT_TYPE": {
        "1": "本地居民",
        "2": "外来人口"
      },
      "STREE_NAME": {
        "1": "南山街道",
        "2": "南头街道",
        "3": "西丽街道",
        "4": "沙河街道",
        "5": "蛇口街道",
        "6": "招商街道",
        "7": "粤港街道",
        "8": "桃源街道"
      },
      "HOUSE_TYPE": {
        "1": "单间",
        "2": "1房1厅",
        "3": "2房1厅",
        "4": "2房2厅",
        "5": "3房1厅",
        "6": "3房2厅",
        "7": "4房1厅",
        "8": "4房2厅",
        "9": "其他"
      },
      "data": {
        "ACCESS_TYPE": {
          "1": "10.51%",
          "2": "22.53%",
          "3": "24.05%",
          "4": "18.91%",
          "5": "11.18%",
          "6": "12.82%"
        },

        "EDUCATIONAL_LEVEL": {
          "1": "504",
          "2": "1135",
          "3": "1120",
          "4": "946",
          "5": "504",
          "6": "378",
          "7": "946",
          "8": "776"
        },
        "AGE": {
          "0-18": "580",
          "18-30": "1702",
          "30-40": "1393",
          "40-50": "1156",
          "50-60": "828",
          "60-70": "350",
          ">70": "283"
        },
        "CHECKIN_STATUS": {
          "1": "86%",
          "2": "24"
        },
        "SEX": {
          "0": "68.19%",
          "1": "31.81%"
        },
        "RESIDENT_TYPE": {
          "1": "68.19",
          "2": "31.81"
        },
        "STREE_CHECKIN_STATUS": {
          "1": "80",
          "2": "70",
          "3": "60",
          "4": "50",
          "5": "40",
          "6": "30",
          "7": "20",
          "8": "10"
        },
        "ENTER_PERIOD": {
          "0-1": "1548",
          "2-3": "2469",
          "3-4": "2024",
          "4-5": "2268",
          "5-6": "1326",
          "6-7": "4805",
          "7-8": "3508",
          "8-9": "4600",
          "9-10": "4334",
          "10-11": "2467",
          "11-12": "1182",
          "12-13": "4020",
          "13-14": "1327",
          "14-15": "1376",
          "15-16": "2250",
          "16-17": "3497",
          "17-18": "2791",
          "18-19": "3585",
          "19-20": "3433",
          "20-21": "1942",
          "21-22": "1009",
          "22-23": "1038",
          "23-24": "3403"
        },
        "GROUNP_TYPE_PERCENT": {
          "vulnerable": "33.33%",
          "focus": "33.33%",
          "normal": "33.33%",
        },
        "HOUSE_TYPE_PERCENT": {
          "1": "100",
          "2": "500",
          "3": "600",
          "4": "400",
          "5": "300",
          "6": "350",
          "7": "400",
          "8": "80",
          "9": "10"
        },
        "VULNERABLE-GROUNP_INFO": {
          "0": {
            "name": "谢大龙",
            "mobile-number": "13539428488",
            "type": "独居老人",
            "address": "龙岗区坂田街道南坑社区北路25号401"
          },
          "1": {
            "name": "谢小龙",
            "mobile-number": "13539428488",
            "type": "残疾家庭",
            "address": "龙岗区坂田街道南坑社区北路25号601"
          }
        },
        "FOCUS-GROUNP_INFO": {
          "0": {
            "name": "谢飞龙",
            "mobile-number": "13539428488",
            "type": "独居老人",
            "address": "龙岗区坂田街道南坑社区北路25号301"
          },
          "1": {
            "name": "谢肥龙",
            "mobile-number": "13539428488",
            "type": "残疾家庭",
            "address": "龙岗区坂田街道南坑社区北路25号201"
          }
        }

      }

    }

    function sum(arr) {
      var s = 0;
      arr.forEach(function (val, index, arr) {
        s += val
      })
      return s
    }

    function quickSort(arr) {

      if (arr.length <= 1) {
        return arr
      }
      var newArr = [];
      for (var i = 0; i < arr.length; i++) {
        newArr[i] = arr[i]
      }
      var index = Math.floor(newArr.length / 2);
      // 中间值
      var temp = newArr.splice(index, 1)
      //定义左右部分数组
      var left = [];
      var right = [];
      for (var i = 0; i < newArr.length; i++) {
        if (newArr[i] < temp) {
          left.push(newArr[i])
        } else {
          right.push(newArr[i])
        }
      }
      return quickSort(left).concat(temp, quickSort(right))
    }

    function getMedian(arr, changeSourceVal) {
      var len = arr.length;
      if (len < 2) {
        return arr
      }
      var tempArr = []
      if (changeSourceVal) {
        tempArr = arr.sort()
      } else {
        tempArr = quickSort(arr)
      }
      if (len % 2 == 1) {
        return tempArr[Math.floor(len / 2)]
      } else {
        return (tempArr[len / 2] + tempArr[len / 2 - 1]) / 2
      }
    }

    var defaultOption = {
      grey: 'rgb(47, 47, 75)',
      bgColor: 'rgba(0,0,0,0.6)',
      pieOption: {
        grid: {
          height: '120'
        },
        tooltip: {
          trigger: 'item',
          formatter: "{a} <br/>{b}: {c} ({d}%)"
        },
        title: {
          show: true,
          x: 'center',
          y: '95',
          textStyle: {
            fontSize: '12',
            color: '#fff',
          }
        },
        series: [{
          label: {
            normal: {
              show: false
            }
          },
          center: ['50%', '40%'],
          name: '占比',
          type: 'pie',
          radius: ['75%', '60%'],
          labelLine: {
            normal: {
              show: false
            }
          },

        }]
      }
    }
    var educational_name = [];
    var educational_value = [];
    var educational_option = [];
    var educational_index = -1;
    for (var key in benkaiData.EDUCATIONAL_LEVEL) {
      educational_name.push(benkaiData.EDUCATIONAL_LEVEL[key]);
      educational_value.push(parseInt(benkaiData.data.EDUCATIONAL_LEVEL[key]))
    };
    for (var i = 0; i < educational_name.length; i++) {
      educational_option[i] = {};
      educational_option[i].name = educational_name[i];
      educational_option[i].value = educational_value[i];
    }

    function keepDecimalFull(num, decimals) {
      var result = parseFloat(num);
      if (isNaN(result)) {
        alert('参数格式错误');
        return false
      }
      result = Math.round(num * Math.pow(10, decimals)) / Math.pow(10, decimals);
      return parseFloat(result.toFixed(decimals))
    }
    var getPercentArr = function (arr, decimals) {
      var percentArr = [];
      var len = arr.length;
      var addPercent = 0;
      for (var i = 0; i < len - 1; i++) {
        percentArr[i] = (arr[i] / sum(arr));
        addPercent += keepDecimalFull(percentArr[i], decimals);
        percentArr[i] = (percentArr[i] * 100).toFixed(decimals) + '%';
      }
      percentArr[len - 1] = (100 - addPercent * 100).toFixed(decimals) + '%';
      return percentArr
    }
    var myChart1 = echarts.init(document.getElementById('educational_level'));
    myChart1.setOption({
      backgroundColor: defaultOption.bgColor,
      color: ['rgb(251, 205, 50)', 'rgb(36, 104, 205)', 'rgb(217, 65, 122)', 'rgb(21, 176, 136)',
        'rgb(215, 80, 76)',
        'rgb(105, 108, 241)', 'rgb(204, 98, 23)', 'rgb(87, 195, 224)'
      ],
      tooltip: {
        trigger: 'item',
        formatter: "{a} <br/>{b}: {c} ({d}%)"
      },
      legend: {
        orient: 'vertical',
        top: 5,
        right: "10%",
        itemWidth: 15,
        itemHeight: 10,
        itemGap: 8,
        formatter: function (a) {
          var percentArr = getPercentArr(educational_value, 2);
          educational_index++;
          var arr = [
            '' + a + '',
            '{b|' + percentArr[educational_index] + '}',
          ]
          return arr.join('')
        },
        textStyle: {
          color: '#fff',
          rich: {
            b: {
              padding: [0, 0, 0, 60],
              align: 'right',
            }
          }

        },
        data: educational_name
      },
      series: [{
        name: '文化水平',
        type: 'pie',
        radius: ["60%", '80%'],
        center: ['25%', '50%'],
        avoidLabelOverlap: false,
        label: {
          normal: {
            show: false,
            position: 'center',
            formatter: '{d}%'
          },
          emphasis: {
            show: true,
            textStyle: {
              fontSize: '30',
              fontWeight: 'bold'
            }
          }
        },
        labelLine: {
          normal: {
            show: false
          }
        },
        data: educational_option
      }]
    });
    myChart1.on('legendselectchanged', function (res) {
      console.log(res)
      var index = -1;
      var total = 0;
      var nameObj = {};
      educational_option.forEach(function (v, i) {
        if (res.selected[v.name]) {
          total += v.value;
          nameObj[v.name] = v.value;
        } else {
          nameObj[v.name] = 0;
        }

      });
      console.log(nameObj)
      console.log(sum(educational_value));
      var name = res.name
      myChart1.setOption({
        legend: {
          formatter: function (a) {
            var arr = [
              '' + a + '',
              '{b|' + ((nameObj[a] / total) * 100).toFixed(2) + '%' + '}',
            ]
            return arr.join('')
          },
        },

      })
    })

    var male_value = [];
    var maleIndex = -1;
    var female_value = [];
    for (var key in benkaiData.data.AGE) {
      male_value.push(Math.floor(benkaiData.data.AGE[key] * 0.3181));
      female_value.push(Math.floor(benkaiData.data.AGE[key] * 0.6819))
    };
    var totalArr = [];
    for (var i = 0; i < male_value.length; i++) {
      totalArr.push(male_value[i] + female_value[i])
    }
    var myChart2 = echarts.init(document.getElementById('population'));
    myChart2.setOption({
      grid: {
        x: 45,
        y: 35,
        width: 360,
        height: 150,
      },
      backgroundColor: defaultOption.bgColor,
      legend: [{
          x: 'center',
          icon: 'rect',
          itemHeight: 8,
          itemWidth: 10,
          data: [{
              name: '男',
            },
            {
              name: '女',
            },
          ],
          textStyle: {
            color: '#fff'
          },
        },
        {
          x: 'right',
          icon: '',
          itemHeight: 20,
          itemWidth: 20,
          data: [{
            name: '中值',
            icon: 'path://M200,93.5h-61.5c-3-16.2-17.3-28.5-34.4-28.5C87,65,72.8,77.3,69.7,93.5H0v13h69.7c3,16.2,17.3,28.5,34.4,28.5c17.1,0,31.3-12.3,34.4-28.5H200V93.5z',
          }, ],
          textStyle: {
            color: '#fff'
          },
        }
      ],
      xAxis: [{
        type: 'category',
        data: ['0-17', '18-30', '30-40', '40-50', '50-60', '60-70', '70以上'],
        axisLabel: {
          textStyle: {
            color: '#fff'
          }
        },

      }, ],
      yAxis: [{
          type: 'value',
          name: '(人数)',
          nameTextStyle: {
            color: "#fff",
            padding: [0, 0, 0, -40]
          },
          axisLabel: {
            textStyle: {
              color: '#fff'
            }
          },
          label: {
            textStyle: {
              color: '#fff'
            },

          },
          splitLine: {
            show: true,
            lineStyle: {
              color: 'rgba(144,144,144,0.2)'
            }
          },
          axisLine: {
            show: false
          },
          axisTick: {
            show: false
          },
        },

      ],
      series: [{
          name: '男',
          type: 'bar',
          stack: '总数',
          data: male_value,
          itemStyle: {
            normal: {
              color: 'rgb(71, 156, 151)',
            }
          },
          label: {
            normal: {
              color: '#fff',
              position: 'top',
              formatter: '{c}'
            },
            emphasis: {
              color: '#fff',
              show: true,
              position: 'center'
            }
          },
          barWidth: 20,
        },
        {
          name: '女',
          type: 'bar',
          stack: '总数',
          data: female_value,
          itemStyle: {
            normal: {
              color: 'rgb(159, 53, 117)',
            }
          },
          label: {
            normal: {
              show: true,
              position: 'top',
              textStyle: {
                color: '#fff',
              },

              formatter: function () {
                maleIndex++;
                return myChart2.getOption().series[0].data[maleIndex] +
                  myChart2.getOption().series[1].data[maleIndex];
              }
            },
            emphasis: {
              show: true,
              position: 'inner',
              formatter: '{c}'
            }
          },
        },
        {
          name: '中值',
          type: 'line',
          data: male_value,
          itemStyle: {
            normal: {
              color: 'rgb(71, 156, 151)',
            }
          },
          label: {
            emphasis: {
              color: '#fff',
              show: true,
              position: 'left',

            }
          },
          barWidth: 20,
        },

      ]
    })


    myChart2.on('legendselectchanged', function (res) {
      var myOp = myChart2.getOption();
      var maleIndex2 = -1;
      if (res.selected['男'] && res.selected['女']) {
        myOp.series[0].label.normal.show = false;
        var index = -1;
        myOp.series[1].label.normal.formatter = function () {
          index++;
          return myChart2.getOption().series[0].data[index] +
            myChart2.getOption().series[1].data[index];
        }
      }
      if (res.selected['男'] && !res.selected['女']) {
        myOp.series[0].label.normal.show = true;
      }
      if (!res.selected['男'] && res.selected['女']) {
        myOp.series[1].label.normal.formatter = '{c}'
      }
      myChart2.setOption(myOp)
    })

    var stree_name = [];
    for (var key in benkaiData.STREE_NAME) {
      stree_name.unshift(benkaiData.STREE_NAME[key])
    }
    var stree_checkin_data = [];
    for (var key in benkaiData.data.STREE_CHECKIN_STATUS) {
      stree_checkin_data.unshift(benkaiData.data.STREE_CHECKIN_STATUS[key])
    }
    var myChart3 = echarts.init(document.getElementById('check_status'));
    myChart3.setOption({
      backgroundColor: defaultOption.bgColor,
      tooltip: {
        show: true,
        formatter: '{b}<br/>{a}:{c}%'
      },
      grid: {
        x: 60,
        y: 5,
        height: 170,
      },
      xAxis: {
        type: 'value',
        axisLine: {
          show: false
        },
        axisTick: {
          show: false
        },
        axisLabel: {
          show: false,

        },
        splitLine: {
          show: false,
        },
      },
      yAxis: {
        type: 'category',
        data: stree_name,
        axisLine: {
          show: false
        },
        axisLabel: {
          textStyle: {
            color: '#fff',
            fontSize: 10,
          }
        },

        axisTick: {
          show: false
        }
      },
      series: [{
        name: '入住率',
        type: 'bar',
        data: stree_checkin_data,
        barWidth: 10,
        // barGap:15,
        barCategoryGap: 14,
        label: {
          normal: {
            show: true,
            position: 'right',
            textStyle: {
              color: '#fff'
            },
            formatter: function (a) {
              return a.data + '%'
            }
          }
        },
        itemStyle: {
          normal: {
            color: new echarts.graphic.LinearGradient(
              0, 0, 1, 0, [{
                  offset: 0,
                  color: 'rgb(14, 37, 92)'
                },
                {
                  offset: 1,
                  color: 'rgb(2, 119, 194)'
                }

              ]
            ),
            barBorderRadius: [6, 6, 6, 6]

          },
        }
      }]

    })

    var enter_period_name = [];
    var enter_period_val = [];
    for (var key in benkaiData.data.ENTER_PERIOD) {
      enter_period_name.push(key);
      enter_period_val.push(benkaiData.data.ENTER_PERIOD[key]);
    }
    var enter_period_obj = [];
    for (var i = 0; i < enter_period_name.length; i++) {
      enter_period_obj[i] = {};
      enter_period_obj[i].name = enter_period_name[i];
      enter_period_obj[i].value = enter_period_val[i];
    }
    var myChart4 = echarts.init(document.getElementById('enter_period'));
    myChart4.setOption({
      tooltip: {
        trigger: 'axis',
        formatter: function (params) {
          var time = params[0].name.split('-');
          let result = time.map(function (item) {
            return item += '点'
          })
          result = result.join('-')
          var tip = '<p>时间段:' + result + '</p>'
          for (var i = 0; i < params.length; i++) {
            tip += '<p>' + params[i].seriesName + ':        ' + params[i].data + '</p>'
          }
          return tip
        }
      },
      legend: [{
          itemHeight: 10,
          itemWidth: 10,
          right: '30%',
          data: [{
            name: '人数',
            icon: 'circle',
            textStyle: {
              color: '#fff'
            }
          }]
        },
        {
          right: '10%',
          data: [{
            name: '同比值',
            icon: 'path://M200,93.5h-61.5c-3-16.2-17.3-28.5-34.4-28.5C87,65,72.8,77.3,69.7,93.5H0v13h69.7c3,16.2,17.3,28.5,34.4,28.5c17.1,0,31.3-12.3,34.4-28.5H200V93.5z',
            textStyle: {
              color: '#fff'
            }
          }]
        }
      ],
      grid: {
        width: 350,
        height: 150,
        x: 40,
        y: 40
      },
      backgroundColor: defaultOption.bgColor,
      xAxis: {
        type: 'category',
        boundaryGap: false,
        data: enter_period_name,
        axisLine: {
          show: false
        },
        axisTick: {
          show: false
        },
        axisLabel: {
          textStyle: {
            color: '#fff',
            fontSize: 10,
          }
        },
      },
      yAxis: {
        name: '(人数)',
        type: 'value',
        nameTextStyle: {
          color: "#fff",
          padding: [0, 0, 0, -40]
        },
        axisLine: {
          show: false
        },
        axisTick: {
          show: false
        },
        splitLine: {
          show: true,
          lineStyle: {
            color: 'rgba(144,144,144,0.2)'
          }
        },
        axisLabel: {
          textStyle: {
            color: '#fff',
            fontSize: 10,
          }
        },
      },
      series: [{
          data: enter_period_val,
          name: "人数",
          type: 'line',
          showAllSymbol: true,
          itemStyle: {
            normal: {
              lineStyle: {
                color: 'rgba(114, 113, 249,1)'
              },
              color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [ //颜色渐变函数 前四个参数分别表示四个位置依次为左、下、右、上
                {
                  offset: 0,
                  color: 'rgba(114, 113, 249,0.7)'
                },
                {
                  offset: 1,
                  color: 'rgba(114, 113, 249,0.2)'
                },
              ]),
              areaStyle: {
                type: 'default'
              },

            },
          }
        },
        {
          data: [2100, 4000, 3000, 4500, 5000, 2100, 4000, 3000, 4500, 5000, 2100, 4000, 2100, 4000, 3000,
            4500,
            5000, 2100, 4000, 3000, 4500, 5000, 2100, 4000
          ],
          name: '同比值',
          type: 'line',

          itemStyle: {
            normal: {
              lineStyle: {
                color: 'rgb(68, 185, 243)',
              },
              color: 'rgb(68, 185, 243)'
            },
          }
        },
      ]


    })
    var pie1 = echarts.init(document.getElementById('checkin_status'));
    var pie2 = echarts.init(document.getElementsByClassName("native")[0]);
    var pie3 = echarts.init(document.getElementsByClassName("non-native")[0]);
    var pie4 = echarts.init(document.getElementsByClassName("male")[0]);
    var pie5 = echarts.init(document.getElementsByClassName("female")[0]);

    pie1.setOption(defaultOption.pieOption);
    pie1.setOption({
      title: {
        text: '入住率'
      },
      series: [{
        data: [{
            name: '未入住',
            value: 14,
            itemStyle: {
              normal: {
                color: defaultOption.grey
              }
            }
          },
          {
            name: '已入住',
            value: 86,
            itemStyle: {
              normal: {
                color: {
                  type: 'linear',
                  x: 0,
                  y: 0,
                  x1: 1,
                  y1: 1,
                  colorStops: [{
                      offset: 0,
                      color: '#afa73f' // 0% 处的颜色
                    },
                    {
                      offset: 1,
                      color: '#875923' // 100% 处的颜色
                    }
                  ],
                  globalCoord: true // 缺省为 false
                }
              }
            },
            label: {
              normal: {
                show: true,
                color: '#fff',
                position: 'center',
                formatter: function (a) {
                  return a.percent + '%'
                },
                textStyle: {
                  fontSize: '12',
                  fontWeight: 'bold'
                }
              },
              emphasis: {
                show: true,
              },
            },
          },
        ]

      }, ]
    });
    pie2.setOption(defaultOption.pieOption);
    pie2.setOption({
      title: {
        text: '本地居民'
      },
      series: [{
        data: [{
            name: '外来人口',
            value: 3181,
            itemStyle: {
              normal: {
                color: defaultOption.grey
              }
            }
          },
          {
            name: '本地居民',
            value: 6819,
            itemStyle: {
              normal: {
                color: {
                  type: 'linear',
                  x: 0,
                  y: 0,
                  x1: 1,
                  y1: 1,
                  colorStops: [{
                      offset: 0.2,
                      color: 'rgb(48, 146, 212)' // 0% 处的颜色
                    },
                    {
                      offset: 1,
                      color: 'rgb(14, 48, 176)' // 100% 处的颜色
                    }
                  ],
                  globalCoord: true // 缺省为 false
                }
                // color:'rgb(48, 146, 212)' 
              }
            },
            label: {
              normal: {
                show: true,
                color: '#fff',
                position: 'center',
                formatter: function (a) {
                  return a.percent + '%'
                },
                textStyle: {
                  fontSize: '12',
                  fontWeight: 'bold'
                }
              },
              emphasis: {
                show: true,
              },
            },
          },

        ]

      }, ]
    })
    pie3.setOption(defaultOption.pieOption);
    pie3.setOption({
      title: {
        text: '外来人口'
      },
      series: [{
        data: [{
            name: '本地居民',
            value: 6819,
            itemStyle: {
              normal: {
                color: defaultOption.grey
              }
            },
            label: {
              normal: {
                // show: true,
                color: '#fff',
                // position: 'center',
                formatter: function (a) {
                  return a.percent + '%'
                },
                textStyle: {
                  fontSize: '12',
                  fontWeight: 'bold'
                }
              },
              emphasis: {
                show: true,
              },
            },
          },

          {
            name: '外来人口',
            value: 3181,
            itemStyle: {
              normal: {
                color: {
                  type: 'linear',
                  x: 0,
                  y: 0,
                  x1: 1,
                  y1: 1,
                  colorStops: [{
                      offset: 0,
                      color: '#5e2bb3' // 0% 处的颜色
                    },
                    {
                      offset: 1,
                      color: 'rgb(99, 100, 213)' // 100% 处的颜色
                    }
                  ],
                  globalCoord: true // 缺省为 false
                }
              }
            },
            label: {
              normal: {
                show: true,
                color: '#fff',
                position: 'center',
                formatter: function (a) {
                  return a.percent + '%'
                },
                textStyle: {
                  fontSize: '12',
                  fontWeight: 'bold'
                }
              },
              emphasis: {
                show: true,
              },
            },
          },
        ]

      }, ]
    })
    pie4.setOption(defaultOption.pieOption);
    pie4.setOption({
      tooltip: {
        trigger: 'item',
        formatter: "{a} <br/>{b}: {c} ({d}%)"
      },
      title: {
        text: '男性占比',
        textStyle: {
          fontSize: '12',
          color: '#fff',
        }
      },
      series: [{
        name: '占比',
        type: 'pie',

        labelLine: {
          normal: {
            show: false
          }
        },
        data: [{
            value: 1068701,
            name: '女',
            itemStyle: {
              normal: {
                color: defaultOption.grey
              },
            },
            label: {
              normal: {
                show: false,
                formatter: function (a) {
                  return a.percent + '%'
                },
              },
              emphasis: {
                show: true,
                position: 'center',
                textStyle: {
                  fontSize: '12',
                  fontWeight: 'bold'
                },
              },
            }
          },

          {
            value: 498999,
            name: '男',
            itemStyle: {
              normal: {
                color: {
                  type: 'linear',
                  x: 0,
                  y: 0,
                  x1: 1,
                  y1: 1,
                  colorStops: [{
                      offset: 0,
                      color: '#0e4672' // 0% 处的颜色
                    },
                    {
                      offset: 1,
                      color: '#21cda2' // 100% 处的颜色
                    }
                  ],
                  globalCoord: true // 缺省为 false
                }
              }
            },
            label: {
              normal: {
                show: true,
                color: '#fff',
                position: 'center',
                formatter: function (a) {
                  return a.percent + '%'
                },
                textStyle: {
                  fontSize: '12',
                  fontWeight: 'bold'
                }
              },
              emphasis: {
                show: true,
              },
            },
          },
        ]
      }]
    })
    pie5.setOption(defaultOption.pieOption);
    pie5.setOption({
      title: {
        text: '女性占比',
        textStyle: {
          fontSize: '12',
          color: '#fff',
        }
      },

      tooltip: {
        trigger: 'item',
        formatter: "{a} <br/>{b}: {c} ({d}%)"
      },

      series: [{
        name: '占比',
        type: 'pie',
        labelLine: {
          normal: {
            show: false
          }
        },
        data: [{
            value: 498999,
            name: '男',
            itemStyle: {
              normal: {
                color: defaultOption.grey
              }
            },
            label: {
              normal: {
                show: false,
                formatter: function (a) {
                  return a.percent + '%'
                },
                textStyle: {
                  fontSize: '12'
                }
              },
              emphasis: {
                position: 'center',
                show: true,
                textStyle: {
                  fontWeight: 'bold'
                }
              },

            },
          },
          {
            value: 1068701,
            name: '女',
            itemStyle: {
              normal: {
                color: {
                  type: 'linear',
                  x: 0,
                  y: 0,
                  x1: 1,
                  y1: 1,
                  colorStops: [{
                      offset: 0,
                      color: '#d43c80' // 0% 处的颜色
                    },
                    {
                      offset: 1,
                      color: '#5e1190' // 100% 处的颜色
                    }
                  ],
                  globalCoord: true // 缺省为 false
                }
              }
            },
            label: {
              normal: {
                color: '#fff',
                show: true,
                position: 'center',
                formatter: function (a) {
                  return a.percent + '%'
                }
              },
              emphasis: {
                show: true,
                position: 'center',
                textStyle: {
                  fontSize: '12',
                  fontWeight: 'bold'
                },
              },
            }
          },
        ]
      }]
    });
    var house_type_value = ['820', '1758', '1876', '1475', '872', '1000', '1536', '591', '150'];
    house_type_value.forEach(function (value, index, array) {
      array[index] = Math.floor(value / 3)
    })
    type_index = -1;
    var house_type_total = ['820', '1758', '1876', '1475', '872', '1000', '1536', '591', '150'];
    var myChart5 = echarts.init(document.getElementById('house_type'));
    var house_type_name = [];
    for (var key in benkaiData.HOUSE_TYPE) {
      house_type_name.push(benkaiData.HOUSE_TYPE[key])
    }
    var houses_amount = [20, 30, 40, 50, 60, 70, 80, 90, 100]
    myChart5.setOption({
      grid: {
        x: 0,
        y: 35,
        width: '100%',
        height: '70%',
      },
      backgroundColor: defaultOption.bgColor,
      legend: [{
          left: '10%',
          icon: 'rect',
          itemHeight: 8,
          itemWidth: 8,
          textStyle: {
            color: '#fff'
          },
          data: [{
              name: '关爱人群',
            },
            {
              name: '重点人群',
            },
            {
              name: '普通人群',
            },
          ]
        },
        {
          right: '10%',
          itemHeight: 20,
          itemWidth: 20,
          textStyle: {
            color: '#fff'
          },
          data: [{
            name: '房屋数量',
            icon: 'path://M200,93.5h-61.5c-3-16.2-17.3-28.5-34.4-28.5C87,65,72.8,77.3,69.7,93.5H0v13h69.7c3,16.2,17.3,28.5,34.4,28.5c17.1,0,31.3-12.3,34.4-28.5H200V93.5z',
          }, ]
        },
      ],
      xAxis: [{
        type: 'category',
        data: house_type_name,
        axisLabel: {
          textStyle: {
            color: '#fff',
            fontSize: 10,
          },
          interval: 0
        },
      }, ],
      yAxis: [{
          type: 'value',
          name: '人数',
          offset: -25,
          axisLabel: {
            show: false,
          },
          label: {
            textStyle: {
              color: '#fff'
            },

          },
          splitLine: {
            show: true,
            lineStyle: {
              color: 'rgba(144,144,144,0.2)'
            }
          },
          axisLine: {
            show: false
          },
          axisTick: {
            show: false
          },
        },
        {
          type: 'value',
          name: '房屋数量',
          axisLabel: {
            show: true,
            textStyle: {
              color: '#fff'
            }
          },
          label: {
            textStyle: {
              color: '#fff'
            },

          },
          splitLine: {
            show: false,
          },
          axisLine: {
            show: true
          },
          axisTick: {
            show: true
          },
        },

      ],
      series: [{
          name: '关爱人群',
          type: 'bar',
          stack: '合计',
          data: house_type_value,
          itemStyle: {
            normal: {
              color: 'rgb(38, 158, 159)'
            }
          },
          label: {
            normal: {
              color: '#fff',
              position: 'top',
            },
            emphasis: {
              color: '#fff',
              show: true,
              position: 'center'
            }
          },
          barWidth: 15,
        },
        {
          name: '重点人群',
          type: 'bar',
          data: house_type_value,
          stack: '合计',
          itemStyle: {
            normal: {
              color: 'rgb(1, 118, 214)'
            }
          },
          label: {
            normal: {
              color: '#fff',
              position: 'top',
            },
            emphasis: {
              show: true,
              position: 'inner',
              formatter: '{c}'
            }
          }
        },
        {
          name: '普通人群',
          type: 'bar',
          stack: '合计',
          data: house_type_value,
          itemStyle: {
            normal: {
              color: 'rgb(176, 103, 68)',
            },
          },
          label: {
            normal: {
              show: true,
              position: 'top',
              textStyle: {
                color: '#fff',
              },
              formatter: function () {
                var percentArr = getPercentArr(houses_amount, 2)
                type_index++
                return percentArr[type_index]
              }
            },
            emphasis: {
              show: true,
              position: 'inner',
              formatter: '{c}'
            }
          },
        },
        {
          type: 'line',
          // z:
          name: '房屋数量',
          data: houses_amount,
          yAxisIndex: 1,
          itemStyle: {
            normal: {
              color: '#58c5dd'
            }
          },
          label: {
            emphasis: {
              show: true,
              position: 'top',
              textStyle: {
                color: '#fff'
              }
            }
          }
        }
      ]
    })
    var arr = new Array(["b", 2, "a", 4, "test"]);

    function isInArray(arr, val) {
      var testStr = ',' + arr.join(",") + ",";
      return testStr.indexOf("," + val + ",") != -1
    }
    myChart5.on('legendselectchanged', function (res) {
      var myOp = myChart5.getOption();
      console.log(myOp.series);
      console.log(res);
      var check_val = 0;
      var check_arr = [];
      for (var key in res.selected) {
        if (res.selected[key]) {
          check_arr.push(key);
          check_val++
        }
      }
      var index = -1
      console.log(check_arr);

      if (check_val == 4) {
        myOp.series[0].label.normal.show = false;
        myOp.series[1].label.normal.show = false;
        myOp.series[2].label.normal.show = true;
        myOp.series[2].label.normal.formatter = function () {
          var percentArr = getPercentArr(houses_amount, 2)
          index++
          return percentArr[index]
        }
      }

      if (check_val == 1) {
        console.log('1');
        if (isInArray(check_arr, "关爱人群")) {
          myOp.series[0].label.normal.show = true
        }
        if (isInArray(check_arr, '重点人群')) {
          myOp.series[1].label.normal.show = true
        }
        if (isInArray(check_arr, '普通人群')) {
          myOp.series[2].label.normal.show = true

          myOp.series[2].label.normal.formatter = '{c}'
        }
      }
      if (check_val == 3 && !res.selected['房屋数量']) {
        myOp.series[0].label.normal.show = false;
        myOp.series[1].label.normal.show = false;
        myOp.series[2].label.normal.show = true;
        myOp.series[2].label.normal.formatter = function () {
          index++
          return myOp.series[0].data[index] +
            myOp.series[1].data[index] +
            myOp.series[2].data[index];
        }
        // myOp.series[0].label.normal.show = false;
        // myOp.series[1].label.normal.show = false;
        // myOp.series[2].label.normal.show = false;
      }
      myChart5.setOption(myOp)
    })



  })
</script>

</html>